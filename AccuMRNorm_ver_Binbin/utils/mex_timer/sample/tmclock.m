function tmclock( command )
%Simple example of real-time digital clock using timer.dll MEX-file.                    
%Start program typing "tmclock" in MATLAB command prompt. 
%Note that there is no loop in program.

global CLOCK_HND 

if nargin==0
   command='cmInit';
end

switch command
   case 'cmInit'
      if ~isempty(CLOCK_HND)
         error('This example does not allow multilpe program instances');
      end   
      CLOCK_HND=InitGui;                   
      CLOCK_HND.hTimer=timer('SetTimer',...%Defines Windows timer
         1000,...                          %Timer elapse time in ms  
         'tmclock(''cmRefresh'');'...      %Timer callback string
         );
   case 'cmRefresh'   
      set(CLOCK_HND.hClock, 'String', datestr(now,'HH:MM:SS'));
   case 'cmClose'
      timer('KillTimer',CLOCK_HND.hTimer); %Delete timer
      clear timer;
      clear global CLOCK_HND;
end   

function CLOCK_HND=InitGui()
%GUI Initialisation
CLOCK_HND.hFig = figure(...
   'BackingStore','off', ...
   'Name','Clock',...
   'NumberTitle','off',...
   'resize','off',...
   'Color',[0.8 0.8 0.8], ...
   'MenuBar','none', ...
   'Position',[120 250 160 70], ...
   'Tag','Fig',...
   'DeleteFcn','tmclock(''cmClose'');'...   
   );

CLOCK_HND.hClock = uicontrol(...
    'Parent',gcf, ...
    'Units','points', ...
    'BackgroundColor',[0 0 0], ...
    'FontSize',14, ...
    'ForegroundColor',[0 1 0], ...
    'Position',[20 15 80 20], ...
    'Style','text', ...
    'Tag','Clock'...
    );
